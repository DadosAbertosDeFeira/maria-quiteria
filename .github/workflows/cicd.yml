name: "Pipeline para build de imagem docker"
on:
  push: 
  release:
    types: [created]

env:
  TF_VAR_image: ezmom/mariaquiteria:latest

jobs:
  docker:
    uses: "mentoriaiac/cicd_centralizado/.github/workflows/docker_build.yaml@v1"
    with:
      image: ezmom/mariaquiteria
      push_image: ${{github.event_name == 'release'}}
    secrets:
      docker_user: ${{secrets.DOCKER_LOGIN}}
      docker_password: ${{secrets.TOKEN_DOCKERHUB}}

  terraform:
    needs: docker
    uses: "mentoriaiac/cicd_centralizado/.github/workflows/terraform.yaml@v1"
    with:
      plan: true
      apply: true
      working_directory: ./iac
      workspace: default
    secrets: inherit
